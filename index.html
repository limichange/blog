<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Limichange Blog" type="application/atom+xml" />






<meta property="og:type" content="website">
<meta property="og:title" content="Limichange Blog">
<meta property="og:url" content="http://limichange.uedtoutiao.com/index.html">
<meta property="og:site_name" content="Limichange Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Limichange Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: 'KZ8H31F2HO',
      apiKey: '7cce19690b59c1203a116bec55f8c201',
      indexName: 'index',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://limichange.uedtoutiao.com/"/>





  <title>Limichange Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-62558211-10', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9f94f824db823c51e97cc40b683db034";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Limichange Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/16/postWindow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/16/postWindow/" itemprop="url">ä½¿ç”¨postWindowåœ¨ç½‘é¡µç›´æ¥é€šä¿¡</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-16T10:21:50+08:00">
                2017-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>æœ‰è¿™ä¹ˆä¸€ä¸ªæ•ˆæœï¼Œå°±æ˜¯éœ€è¦åœ¨ä¸¤ä¸ªé¡µé¢ç›´æ¥å‘ä¿¡æ¯ã€‚å…·ä½“å°±æ˜¯Aé¡µé¢ç‚¹å¼€ç¬¬ä¸‰æ–¹ç™»å½•é¡µé¢Bï¼ŒéªŒè¯æˆåŠŸåï¼ŒBé¡µé¢å…³é—­ç„¶åé€šçŸ¥Aé¡µé¢ã€‚</p>
<p>é€šä¿¡çš„æ–¹æ³•å¯ä»¥ç”¨<code>localStorage</code>æ¥å¤„ç†ï¼Œç”¨æ¥ç›‘æ§æœ‰æ²¡æœ‰äº‹ä»¶è§¦å‘ã€‚ç„¶åçœ‹åˆ°äº†ã€‚å¦‚æœæ˜¯åœ¨ç§»åŠ¨ç«¯å°±æŒºå¥½çš„ã€‚<code>postWindow</code>ï¼Œæ„Ÿè§‰æ›´é€‚åˆå°±å®éªŒäº†ä¸€ä¸‹ã€‚</p>
<h2 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h2><p>é¡¹ç›®åœ¨githubã€‚<br><a href="https://github.com/limichange/window.postMessage" target="_blank" rel="external">https://github.com/limichange/window.postMessage</a></p>
<h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p>é¦–å…ˆå¾—æœ‰ç›‘å¬<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, (event) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'received response:  '</span>, event.data)</div><div class="line">&#125;, <span class="literal">false</span>)</div></pre></td></tr></table></figure></p>
<p>ç„¶åæ‰“å¼€ä¸€ä¸ªç½‘é¡µ<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myPopup = <span class="built_in">window</span>.open(<span class="string">'http://localhost:8080'</span>, <span class="string">'page'</span>)</div></pre></td></tr></table></figure></p>
<p>å¼€å§‹å‘å‘å‘å‘<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">var</span> message = <span class="string">'Hello!  The time is: '</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>().getTime())</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'blog.local:  sending message:  '</span> + message)</div><div class="line">  myPopup.postMessage(message, <span class="string">'http://localhost:8080'</span>)</div><div class="line">&#125;, <span class="number">6000</span>)</div></pre></td></tr></table></figure></p>
<h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>é™¤äº†IEçš„å…¼å®¹æ€§éƒ½æŒºä¸é”™çš„ï¼Œæ‰€ä»¥åœ¨å›½å†…è¿˜æ˜¯è€è€å®å®ç”¨<code>localStorage</code>æ¥å¤„ç†ã€‚å¦‚æœæ˜¯åœ¨ç§»åŠ¨ç«¯å°±æŒºå¥½çš„ã€‚</p>
<p><a href="https://caniuse.com/#search=postMessage" target="_blank" rel="external">https://caniuse.com/#search=postMessage</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/13/Ingress-lv11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/13/Ingress-lv11/" itemprop="url">Ingress lv11</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-13T10:43:39+08:00">
                2017-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‡çº§åˆ°11äº†"><a href="#å‡çº§åˆ°11äº†" class="headerlink" title="å‡çº§åˆ°11äº†"></a>å‡çº§åˆ°11äº†</h2><p>å¯ä»¥ç”³è¯·poäº† ğŸŒ</p>
<p><img src="/images/WechatIMG128.jpeg" alt="ingress-lv11"><br><img src="/images/WechatIMG129.jpeg" alt="ingress-lv11"><br><img src="/images/WechatIMG130.jpeg" alt="ingress-lv11"></p>
<blockquote>
<p>ä¼°è®¡lv12å¾—åˆ°æ˜å¹´</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/12/my-animation-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/12/my-animation-list/" itemprop="url">My Animation List</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-12T19:42:02+08:00">
                2017-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©å†™ä¸ªäº†ä¸€ä¸ªå·¥å…·ï¼Œæ¬¢è¿star ğŸ˜†<br><a href="https://limichange.github.io/my-animation-list/" target="_blank" rel="external">https://limichange.github.io/my-animation-list/</a></p>
<p>è¿™ä¸ªå·¥å…·ä¸»è¦æ˜¯ä¾›æˆ‘å†™H5çš„æ—¶å€™åšå°åŠ¨ç”»çš„ï¼ŒæŠŠå¹³æ—¶å¸¸ç”¨çš„åŠ¨ç”»cssæŠ½å‡ºæ¥ï¼Œç”¨çš„æ—¶å€™ç›´æ¥æ‰¾ä¸€ä¸ªè¿‘ä¼¼çš„copyï¼Œç„¶åæ”¹ä¸€æ”¹ã€‚</p>
<p>å› ä¸ºä¸æ˜¯ä¸ºäº†å¿«é€Ÿæ„å»ºæ ‡å‡†åŠ¨ç”»çš„ï¼Œæ‰€ä»¥æ²¡å¿…è¦åšæˆåº“å‘å¸ƒå‡ºå»ã€‚</p>
<blockquote>
<p>Open &amp;&amp; Select &amp;&amp; Copy</p>
</blockquote>
<p>å°½é‡çš„ç®€å•å¿«æ·ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/10/åæœˆæ–°ç•ªæ¨è/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/10/åæœˆæ–°ç•ªæ¨è/" itemprop="url">åæœˆæ–°ç•ªæ¨è - å°‘å¥³ç»ˆæœ«æ—…è¡Œ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-10T21:41:10+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/images/1431ca5bb2f7143062e3df8f21b8448cf8cccc13.jpg" alt="ç›—å›¾"></p>
<p>åæœˆæ–°ç•ªä¸Šæ¶å•¦ï¼æœ¬æ¬¡æ¨èä¸€ä¸ªè¾ƒä¸ºå†·é—¨çš„æ–°ç•ªï¼å°‘å¥³ç»ˆæœ«æ—…è¡Œï¼</p>
<p><a href="https://bangumi.bilibili.com/anime/6463/play#115184" target="_blank" rel="external">Bç«™åœ°å€</a><br><a href="http://manhua.dmzj.com/snzmlx" target="_blank" rel="external">æ¼«ç”»</a></p>
<h2 id="å…³é”®è¯"><a href="#å…³é”®è¯" class="headerlink" title="å…³é”®è¯"></a>å…³é”®è¯</h2><p>å†›è¿·ã€ç™¾åˆã€æœ«ä¸–ã€å…¬è·¯</p>
<h2 id="å¤§è‡´"><a href="#å¤§è‡´" class="headerlink" title="å¤§è‡´"></a>å¤§è‡´</h2><p>ç®€å•çš„æ¥è¯´å°±æ˜¯ä¸¤ä½å°‘å¥³çš„æ—…è¡Œæ•…äº‹ï¼Œç¢°åˆ°ä¸€äº›è¶£äº‹ã€‚æ€ä¹ˆè¯´å‘¢ï¼Ÿå¾ˆæ¸©é¦¨ï¼Ÿ</p>
<p>é€‚åˆåƒå®Œé¥­åçœ‹ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/06/çœ‹Koaçš„æºç /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/06/çœ‹Koaçš„æºç /" itemprop="url">çœ‹Koaçš„æºç </a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-06T16:09:19+08:00">
                2017-10-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å¦‚æœä½ å¯¹è¯´æ˜æ²¡å…´è¶£ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢ä¸€ç« èŠ‚ã€‚</p>
<p>èµ·å› æ˜¯æˆ‘çœ‹åˆ°äº†ä¸€ç¯‡æ‹›è˜è¯´æ˜ï¼Œä¸Šé¢è¦æ±‚åº”è¯•è€…å¯¹koaçš„æºç äº†å¦‚æŒ‡æŒã€‚å¾ˆæƒ­æ„§ï¼Œæˆ‘è™½ç„¶ä½¿ç”¨koaæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä½†çš„ç¡®æ²¡æœ‰ä»”ç»†çš„çœ‹è¿‡koaçš„æºç ã€‚äºæ˜¯æˆ‘å°±åˆ°ç½‘ä¸Šæœç´¢äº†ä¸€äº›å…³äºkoaæ·±å…¥çš„è¯´æ˜æˆ–æ•™ç¨‹ã€‚ä½†å¾ˆé—æ†¾ï¼Œå¤§å¤šæ•°çš„æ–‡ç« è¾ƒè€ï¼Œåœç•™åœ¨<code>Genetator</code>çš„ç‰ˆæœ¬ï¼Œæˆ–åªæ˜¯æåŠäº†å‡ ä¸ªå…³é”®çš„æ ¸å¿ƒï¼Œå¹¶ä¸å…¨é¢ï¼Œæˆ–æ˜¯å†™å¾—è¾ƒä¸ºå‡Œä¹±ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆä¸è‡ªå·±å†™ä¸€ç¯‡å‘¢ï¼Ÿ</p>
<p>å¦‚æœä½ å·²ç»ä½¿ç”¨koaä¸€æ®µæ—¶é—´äº†ï¼Œä¸”å¯¹ä¸€äº›APIæ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œç°åœ¨æƒ³æ›´åŠ çš„ç²¾è¿›ä¸€äº›ã€‚åˆæˆ–æ˜¯ä½ æ˜¯åˆšç”¨koaçš„æ–°æ‰‹ï¼Œæƒ³ä»ä¸­å­¦äº›æ¯”è¾ƒæœ‰ç”¨çš„çŸ¥è¯†ã€‚é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å¾ˆé€‚åˆä½ ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä¼šäº‹æ— å·¨ç»†çš„ä¸ºä½ ä»‹ç»koaçš„æ–¹æ–¹é¢é¢ï¼Œå°½é‡å¯¹æ¯ä¸€ä¸ªå‡½æ•°å’Œå˜é‡è¿›è¡Œè¯´æ˜ã€‚å½“ç„¶ï¼Œæˆ‘æ²¡æœ‰åŠæ³•ä¿è¯æ‰€æœ‰çš„è¯´æ˜éƒ½æ˜¯å¯¹çš„ï¼Œå¦‚æœä½ å‘ç°äº†é”™è¯¯ï¼Œè¯·åœ¨æœ€åé¢ç•™è¨€ï¼Œæˆ‘ä¼šå°½å¿«çš„ä¿®æ”¹ã€‚</p>
<p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ ï¼šï¼‰</p>
<h2 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h2><p>æˆ‘ä»¬çœ‹çš„æ˜¯2.3.0ç‰ˆæœ¬ï¼Œæˆ‘Forkäº†ä¸‹æ¥ä»¥ä¿è¯å’Œæ–‡ç« åŒæ­¥ï¼Œå› ä¸ºè¿™ç¯‡æ–‡ç« åœ¨æœªæ¥ä¹Ÿä¼šè¿‡æ—¶ã€‚<br><a href="https://github.com/limichange/koa" target="_blank" rel="external">https://github.com/limichange/koa</a></p>
<h2 id="é¦–å…ˆ"><a href="#é¦–å…ˆ" class="headerlink" title="é¦–å…ˆ"></a>é¦–å…ˆ</h2><p>è¿™ä¸ªæ˜¯å®˜æ–¹çš„ä¸Šæ‰‹ä¾‹å­ï¼Œç®€å•è®°å¿†ä¸€ä¸‹ã€‚å¦‚æœä½ å¯¹ä»£ç ä¸­çš„<code>async</code>å’Œ<code>=&gt;</code>æ„Ÿåˆ°å›°æƒ‘ï¼Œé‚£ä¹ˆä½ éœ€è¦å…ˆå»å­¦ä¹ ä¸€ä¸‹<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference" target="_blank" rel="external">æœ€æ–°çš„jsè¯­æ³•</a>ã€‚å› ä¸ºæˆ‘ä»¬çœ‹çš„ç›®å‰æ˜¯æœ€æ–°ç‰ˆçš„koaï¼Œæ‰€ä»¥ä½ å¯ä»¥å¿½ç•¥generatorçš„çŸ¥è¯†ï¼Œå½“ç„¶å­¦ä¸€ä¸‹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼šï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</div><div class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</div><div class="line"></div><div class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</div><div class="line">  ctx.body = <span class="string">'Hello World'</span>;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥çš„å†…å®¹å°†ä¼šä»è¿™ä¸ªä¾‹å­å±•å¼€ã€‚</p>
<h2 id="æ‰¾å…¥å£"><a href="#æ‰¾å…¥å£" class="headerlink" title="æ‰¾å…¥å£"></a>æ‰¾å…¥å£</h2><p>é¦–å…ˆè¦æ‰¾åˆ°å…¥å£çš„æ–‡ä»¶ï¼Œä¸ç„¶æˆ‘ä»¬å°±ä¸çŸ¥é“ä»ä½•çœ‹èµ·äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨koaåŒ…çš„<a href="https://github.com/limichange/koa/blob/master/package.json#L5" target="_blank" rel="external">package.json</a>é‡Œæ‰¾åˆ°ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"lib/application.js"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œæˆ‘ä»¬æ‰¾åˆ°å…¥å£çš„æ–‡ä»¶äº†ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</p>
<h2 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h2><p>è®©æˆ‘ä»¬æŠŠç›®å…‰è½¬åˆ°<a href="https://github.com/limichange/koa/blob/master/lib/application.js" target="_blank" rel="external">lib/application.js</a>ã€‚é¦–å…ˆå¤§è‡´çš„çœ‹ä¸€ä¸‹æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬å…ˆæŠŠæ–‡ä»¶ç®€åŒ–ä¸€ä¸‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å¼•å…¥å…¶ä»–çš„æ¨¡å—</span></div><div class="line"><span class="keyword">const</span> Emitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Koaçš„Classå®šä¹‰</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">Emitter</span> </span>&#123;</div><div class="line">  <span class="comment">// å…·ä½“çš„å†…å®¹</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// ä¸€ä¸ªè¾…åŠ©çš„å‡½æ•°</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">respond</span>(<span class="params">ctx</span>) </span>&#123;</div><div class="line">  <span class="comment">// å…·ä½“çš„å†…å®¹</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·çœ‹èµ·æ¥å°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<p><a href="https://nodejs.org/dist/latest-v8.x/docs/api/events.html" target="_blank" rel="external">events</a>æ˜¯nodejsçš„å†…ç½®åŸºæœ¬åº“ã€‚å¦‚æœä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå¯ä»¥å»çœ‹çœ‹å®˜æ–¹çš„æ–‡æ¡£ã€‚</p>
<p>æ¥ç€çœ‹è¿™ä¸ªClassçš„æ„é€ å‡½æ•°ã€‚è®©æˆ‘ä»¬ç¨å¾®è¿˜åŸä¸€ä¸‹æ–‡ä»¶ï¼Œå¡«ä¸Šæˆ‘ä»¬è¦çœ‹çš„å†…å®¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å¼•å…¥å…¶ä»–çš„æ¨¡å—</span></div><div class="line"><span class="keyword">const</span> response = <span class="built_in">require</span>(<span class="string">'./response'</span>);</div><div class="line"><span class="keyword">const</span> context = <span class="built_in">require</span>(<span class="string">'./context'</span>);</div><div class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'./request'</span>);</div><div class="line"><span class="keyword">const</span> Emitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Koaçš„Classå®šä¹‰</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">Emitter</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.proxy = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">this</span>.middleware = [];</div><div class="line">    <span class="keyword">this</span>.subdomainOffset = <span class="number">2</span>;</div><div class="line">    <span class="keyword">this</span>.env = process.env.NODE_ENV || <span class="string">'development'</span>;</div><div class="line">    <span class="keyword">this</span>.context = <span class="built_in">Object</span>.create(context);</div><div class="line">    <span class="keyword">this</span>.request = <span class="built_in">Object</span>.create(request);</div><div class="line">    <span class="keyword">this</span>.response = <span class="built_in">Object</span>.create(response);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// å…¶ä»–çš„å†…å®¹</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>çœ‹æ ·å­æ˜¯åˆå§‹åŒ–äº†ä¸€äº›å†…éƒ¨çš„å˜é‡ï¼Œæˆ‘ä»¬æŒ¨ä¸ªçœ‹çœ‹ã€‚å…¶ä¸­çš„ä¸‰ä¸ªæˆ‘ä»¬å¯ä»¥ä»æ–‡æ¡£ä¸­æ‰¾åˆ°è§£é‡Šã€‚</p>
<ul>
<li><code>env</code> æ˜¯è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤æ˜¯<code>development</code></li>
<li><code>proxy</code> å¦‚æœä½¿ç”¨ä»£ç†æ¨¡å¼çš„è¯ï¼Œå°±è®¾ä¸º<code>true</code></li>
<li><code>subdomainOffset</code> offset of .subdomains to ignore [2]</li>
</ul>
<p>å¦å¤–<code>middleware</code>ä»åå­—å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯ç”¨æ¥å­˜å‚¨ä¸­é—´ä»¶çš„ã€‚è‡³äºæ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è¯¦ç»†çš„åˆ†æä¸‹ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹æœ€åä¸‰ä¸ªå˜é‡ï¼Œè¿™æ˜¯ä¸ºäº†å‘å¤–éƒ¨æš´éœ²ä¸€äº›å†…éƒ¨çš„åŸå‹å¯¹è±¡ã€‚ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create" target="_blank" rel="external"><code>Object.create</code></a>å¯ä»¥å°†åŸå‹å¤åˆ¶ä¸€ä»½ã€‚ä¸€å¼€å§‹æˆ‘ä¹Ÿå¯¹è¿™ä¸‰ä¸ªå˜é‡æ„Ÿåˆ°å›°æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿäºæ˜¯æˆ‘ç¿»äº†ä¸€ä¸‹koaçš„commitå†å²ï¼Œæ‰¾åˆ°äº†ä¸€æ¬¡<a href="https://github.com/limichange/koa/commit/0be144211189c0ebd2ca059d7f1ee2e72b2ac6b9" target="_blank" rel="external">æäº¤</a>ã€‚</p>
<blockquote>
<p>expose app-specific prototypes, cleanup/fix tests</p>
</blockquote>
<p>å½“ç„¶å®˜æ–¹æ–‡æ¡£é‡Œä¹Ÿè¯´äº†ã€‚</p>
<blockquote>
<p>app.context is the prototype from which ctx is created from. You may add additional properties to ctx by editing app.context. This is useful for adding properties or methods to ctx to be used across your entire app, which may be more performant (no middleware) and/or easier (fewer require()s) at the expense of relying more on ctx, which could be considered an anti-pattern.</p>
</blockquote>
<p>ç®€å•çš„è¯´å°±æ˜¯å¯ä»¥é€šè¿‡ä»–æ·»åŠ ä¸€ä¸ªå…¨å±€çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œè¿™æ ·æ¯”æ·»åŠ ä¸­é—´ä»¶æ–¹ä¾¿è€Œä¸”æ€§èƒ½æ›´å¥½ã€‚å¦‚ä¸‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">app.context.db = db();</div><div class="line"></div><div class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(ctx.db);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æš‚ä¸”ä¸è¦ç®¡ä¸‰ä¸ªå˜é‡çš„é‡Œé¢çš„å…·ä½“å®ç°ï¼Œåé¢ä¼šæ…¢æ…¢è®²ã€‚<br>å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨æŠŠæœ€åˆçš„æ„å»ºæµç¨‹å¼„æ¸…æ¥šäº†ã€‚</p>
<h2 id="app-use"><a href="#app-use" class="headerlink" title="app.use"></a>app.use</h2><p>ç°åœ¨æˆ‘ä»¬çœ‹çœ‹è¿™ä¸€éƒ¨åˆ†ï¼Œ<code>use</code>å‡½æ•°ã€‚æˆ‘ä»¬é€šè¿‡ä»–å¡å…¥ä¸­é—´ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</div><div class="line">  ctx.body = <span class="string">'Hello World'</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è½»æ¾æ‰¾åˆ°<a href="https://github.com/limichange/koa/blob/master/lib/application.js#L94-L115" target="_blank" rel="external">å®šä¹‰çš„åœ°æ–¹</a>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">use(fn) &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">'function'</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'middleware must be a function!'</span>);</div><div class="line">  <span class="keyword">if</span> (isGeneratorFunction(fn)) &#123;</div><div class="line">    deprecate(<span class="string">'Support for generators will be removed in v3. '</span> +</div><div class="line">              <span class="string">'See the documentation for examples of how to convert old middleware '</span> +</div><div class="line">              <span class="string">'https://github.com/koajs/koa/blob/master/docs/migration.md'</span>);</div><div class="line">    fn = convert(fn);</div><div class="line">  &#125;</div><div class="line">  debug(<span class="string">'use %s'</span>, fn._name || fn.name || <span class="string">'-'</span>);</div><div class="line">  <span class="keyword">this</span>.middleware.push(fn);</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆä»–æ£€æŸ¥äº†fnæ˜¯ä¸æ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œä¸­é—´ä»¶éƒ½æ˜¯é€šè¿‡å‡½æ•°çš„æ–¹å¼ä¼ å…¥çš„ã€‚ç„¶åçœ‹çœ‹ä½ ä¼ å…¥çš„æ˜¯ä¸æ˜¯v1ç‰ˆæœ¬çš„ä¸­é—´ä»¶ï¼Œè­¦å‘Šä½ ä¸€ä¸‹ï¼Œå¹¶è´´å¿ƒçš„å¸®ä½ è½¬æ¢åˆ°v2ã€‚æœªæ¥è½¬åŒ–çš„è¿™éƒ¨åˆ†ä¼šåºŸå¼ƒæ‰ï¼Œå°±ä¸è¯¦ç»†è®²äº†ï¼Œç”¨åˆ°çš„<a href="https://github.com/koajs/convert#readme" target="_blank" rel="external">koa-convert</a>å’Œ<a href="https://github.com/ljharb/is-generator-function#readme" target="_blank" rel="external">is-generator-function</a>å¯ä»¥è‡ªå·±è¯¦ç»†çœ‹ã€‚</p>
<p><a href="https://github.com/visionmedia/debug#readme" target="_blank" rel="external">debug</a>æ˜¯å¾ˆå¸¸ç”¨çš„è°ƒè¯•åº“ï¼ŒåŠŸèƒ½å¾ˆå¤šï¼Œæ²¡æœ‰ç”¨è¿‡æˆ–ä¸ç†Ÿæ‚‰çš„ä¸€å®šè¦è¦çœ‹ã€‚</p>
<p><code>middleware</code>å°±æ˜¯æˆ‘ä»¬å‰é¢çœ‹åˆ°çš„é‚£ä¸ªå˜é‡ï¼Œå’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ï¼Œä¸­é—´ä»¶éƒ½è¢«å­˜åˆ°è¿™ä¸ªæ•°ç»„é‡Œé¢äº†ã€‚</p>
<p>æœ€åè¿”å›thisï¼Œå› æ­¤å¯ä»¥åšé“¾å¼çš„è°ƒç”¨ã€‚åƒè¿™æ ·ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app</div><div class="line">  .use(...)</div><div class="line">  .use(...)</div></pre></td></tr></table></figure>
<p>çœ‹æ ·å­è¿™ä¸ªå‡½æ•°ï¼Œåªæ˜¯æŠŠä¸­é—´ä»¶å­˜äº†èµ·æ¥ï¼Œå¹¶æ²¡æœ‰åšä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…ã€‚</p>
<h2 id="app-listen"><a href="#app-listen" class="headerlink" title="app.listen"></a>app.listen</h2><p>æœ€åä¸€ä¸ªéƒ¨åˆ†å°±æ˜¯<code>app.listen</code>äº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.listen(<span class="number">3000</span>)</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°å°±å®šä¹‰åœ¨<a href="https://github.com/limichange/koa/blob/master/lib/application.js#L65-L73" target="_blank" rel="external">Applicationçš„æ„é€ å‡½æ•°çš„ä¸‹é¢</a>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">  * Shorthand for:</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">  *    http.createServer(app.callback()).listen(...)</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">  * @param &#123;Mixed&#125; ...</span></div><div class="line"><span class="comment">  * @return &#123;Server&#125;</span></div><div class="line"><span class="comment">  * @api public</span></div><div class="line"><span class="comment">  */</span></div><div class="line">listen(...args) &#123;</div><div class="line">  debug(<span class="string">'listen'</span>);</div><div class="line">  <span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</div><div class="line">  <span class="keyword">return</span> server.listen(...args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ˜¯ä¸ªå¿«æ·æ–¹å¼ï¼ŒæŠŠç›‘å¬çš„æµç¨‹ç®€åŒ–äº†ä¸€ä¸‹ã€‚è¿™é‡Œå°±æ˜¯ç”¨<a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_http_createserver_requestlistener" target="_blank" rel="external"><code>http.createServer</code></a>åˆ›å»ºäº†ä¸€ä¸ªhttpçš„æœåŠ¡ï¼ŒæŠŠå‚æ•°ç›´æ¥çš„ä¼ å…¥åˆ°<code>server.listen</code>ã€‚æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯<code>this.callback()</code>ã€‚</p>
<p>å…ˆå¤§è‡´çš„çœ‹ä¸€ä¸‹<a href="https://github.com/limichange/koa/blob/master/lib/application.js#L117-L140" target="_blank" rel="external">callbackçš„å®ç°</a>ã€‚è¿™é‡Œæ˜¯æ•´ä¸ªkoaçš„æ ¸å¿ƒï¼Œæ˜¯å¤„ç†è¯·æ±‚çš„åœ°æ–¹ã€‚é€šè¿‡æ³¨é‡ŠçŸ¥é“ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯è¿”å›ä¸€ä¸ªè¯·æ±‚å¤„ç†å›è°ƒç»™nodejsçš„httpä½¿ç”¨ï¼Œå°±å‰é¢listené‡Œçš„ç”¨æ³•ã€‚é¦–å…ˆæˆ‘ä»¬å¤§è‡´çš„ç†æ¸…é‡Œé¢çš„æµç¨‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">  * Return a request handler callback</span></div><div class="line"><span class="comment">  * for node's native http server.</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">  * @return &#123;Function&#125;</span></div><div class="line"><span class="comment">  * @api public</span></div><div class="line"><span class="comment">  */</span></div><div class="line"></div><div class="line">callback() &#123;</div><div class="line">  <span class="comment">// æŠŠä¸­é—´ä»¶å¤„ç†æˆä¸€ä¸ªå‡½æ•°</span></div><div class="line">  <span class="keyword">const</span> fn = compose(<span class="keyword">this</span>.middleware);</div><div class="line"></div><div class="line">  <span class="comment">// ç»‘å®šé»˜è®¤çš„é”™è¯¯å¤„ç†</span></div><div class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.listeners(<span class="string">'error'</span>).length) <span class="keyword">this</span>.on(<span class="string">'error'</span>, <span class="keyword">this</span>.onerror);</div><div class="line"></div><div class="line">  <span class="comment">// é¦–å…ˆæ˜¯åŸç”Ÿçš„`req`å’Œ`res`ä¼ è¿›æ¥</span></div><div class="line">  <span class="keyword">const</span> handleRequest = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line"></div><div class="line">    <span class="comment">// é»˜è®¤çŠ¶æ€ç æ˜¯404</span></div><div class="line">    res.statusCode = <span class="number">404</span>;</div><div class="line"></div><div class="line">    <span class="comment">// ç„¶ååˆ›å»ºctx</span></div><div class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span>.createContext(req, res);</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºé”™è¯¯å¤„ç†çš„å‡½æ•°</span></div><div class="line">    <span class="keyword">const</span> onerror = <span class="function"><span class="params">err</span> =&gt;</span> ctx.onerror(err);</div><div class="line"></div><div class="line">    <span class="comment">// å“åº”å¤„ç†</span></div><div class="line">    <span class="keyword">const</span> handleResponse = <span class="function"><span class="params">()</span> =&gt;</span> respond(ctx);</div><div class="line"></div><div class="line">    <span class="comment">// è°ƒç”¨on-finishedåº“å¤„ç†</span></div><div class="line">    onFinished(res, onerror);</div><div class="line"></div><div class="line">    <span class="comment">// ç”¨ä¸­é—´ä»¶å¤„ç†ctxï¼Œç„¶åå¤„ç†å“åº”ï¼Œæœ€åæ•æ‰é”™è¯¯</span></div><div class="line">    <span class="keyword">return</span> fn(ctx).then(handleResponse).catch(onerror);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="comment">// è¿”å›å¤„ç†å‡½æ•°</span></div><div class="line">  <span class="keyword">return</span> handleRequest;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>TODO</p>
</blockquote>
<h3 id="createContext"><a href="#createContext" class="headerlink" title="createContext"></a>createContext</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">createContext(req, res) &#123;</div><div class="line">  <span class="comment">// è¿˜è®°å¾—å¼€å¤´çœ‹åˆ°çš„é‚£ä¸ªæ„é€ å‡½æ•°å—ï¼Ÿé‡Œé¢æœ€åçš„ä¸‰è¡Œã€‚è¿™é‡Œå°±ç›´æ¥çš„ä½¿ç”¨äº†é‚£ä¸‰ä¸ªå¯¹è±¡ã€‚</span></div><div class="line">  <span class="keyword">const</span> context = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.context);</div><div class="line">  <span class="keyword">const</span> request = context.request = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.request);</div><div class="line">  <span class="keyword">const</span> response = context.response = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.response);</div><div class="line"></div><div class="line">  <span class="comment">// æ¥ä¸‹æ¥å°±æ˜¯å„ç§èµ‹å€¼ï¼ŒæŠŠåŸç”Ÿ`req`å’Œ`res`å­˜èµ·æ¥ï¼Œç»™å¯¹è±¡åšåˆ«åã€‚</span></div><div class="line">  context.app = request.app = response.app = <span class="keyword">this</span>;</div><div class="line">  context.req = request.req = response.req = req;</div><div class="line">  context.res = request.res = response.res = res;</div><div class="line">  request.ctx = response.ctx = context;</div><div class="line">  request.response = response;</div><div class="line">  response.request = request;</div><div class="line">  context.originalUrl = request.originalUrl = req.url;</div><div class="line"></div><div class="line">  <span class="comment">// åˆ›å»º`cookies`ï¼Œå¹³æ—¶ä½ çš„`keys`å°±æ˜¯ç»™è¿™é‡Œç”¨çš„ã€‚</span></div><div class="line">  context.cookies = <span class="keyword">new</span> Cookies(req, res, &#123;</div><div class="line">    keys: <span class="keyword">this</span>.keys,</div><div class="line">    secure: request.secure</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// ç„¶åå°±æ˜¯ipçš„åˆ¤æ–­ã€‚</span></div><div class="line">  request.ip = request.ips[<span class="number">0</span>] || req.socket.remoteAddress || <span class="string">''</span>;</div><div class="line"></div><div class="line">  <span class="comment">// è°ƒç”¨accepts</span></div><div class="line">  context.accept = request.accept = accepts(req);</div><div class="line"></div><div class="line">  <span class="comment">// åˆå§‹åŒ–state</span></div><div class="line">  context.state = &#123;&#125;;</div><div class="line"></div><div class="line">  <span class="comment">// å¤„ç†å®Œæ¯•åæŠŠctxè¿”å›</span></div><div class="line">  <span class="keyword">return</span> context;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢ç”¨åˆ°äº†ä¸¤ä¸ªåº“<a href="https://github.com/pillarjs/cookies#readme" target="_blank" rel="external"><code>cookies</code></a>å’Œ<a href="https://github.com/jshttp/accepts#readme" target="_blank" rel="external">accepts</a>ã€‚å‰è€…å°±æ˜¯ç”¨æ¥æ“ä½œ<code>cookie</code>çš„ï¼Œåè€…æ˜¯å¤„ç†<code>Negotiation</code>ã€‚</p>
<blockquote>
<p>TODO</p>
</blockquote>
<h3 id="respond"><a href="#respond" class="headerlink" title="respond"></a>respond</h3><p>koaåœ¨è¿™é‡Œå¼•å…¥äº†<a href="https://github.com/jshttp/statuses#statuses" target="_blank" rel="external"><code>statuses</code></a></p>
<blockquote>
<p>HTTP status utility for node.</p>
</blockquote>
<p><code>statuses</code>æä¾›äº†å¾ˆå¤šhttpçŠ¶æ€çš„ç®¡ç†æ–¹æ³•ï¼Œå¹³æ—¶å¤„ç†httpçš„æ—¶å€™ä¼šç”¨å¾—ç€ã€‚è¿™é‡Œkoaç”¨æ¥åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦éœ€è¦æŠŠbodyæ¸…ç©ºï¼Œ<a href="https://github.com/jshttp/statuses#statusemptycode" target="_blank" rel="external">æ¯”å¦‚è¿™æ ·</a>ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">status.empty[<span class="number">200</span>] <span class="comment">// =&gt; undefined</span></div><div class="line">status.empty[<span class="number">204</span>] <span class="comment">// =&gt; true</span></div><div class="line">status.empty[<span class="number">304</span>] <span class="comment">// =&gt; true</span></div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥çœ‹æœ¬ä½“ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">respond</span>(<span class="params">ctx</span>) </span>&#123;</div><div class="line">  <span class="comment">// æ²¡æœ‰respondçš„è¯å°±ä¸å¤„ç†</span></div><div class="line">  <span class="keyword">if</span> (<span class="literal">false</span> === ctx.respond) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">  <span class="comment">// æŠŠåŸç”Ÿçš„reså–å‡ºæ¥</span></div><div class="line">  <span class="keyword">const</span> res = ctx.res;</div><div class="line"></div><div class="line">  <span class="comment">// æ˜¯å¦å¯å†™</span></div><div class="line">  <span class="keyword">if</span> (!ctx.writable) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">  <span class="comment">// æŠŠbodyå’ŒçŠ¶æ€ç å–å‡ºæ¥</span></div><div class="line">  <span class="keyword">let</span> body = ctx.body;</div><div class="line">  <span class="keyword">const</span> code = ctx.status;</div><div class="line"></div><div class="line">  <span class="comment">// åˆ¤æ–­è¯¥çŠ¶æ€æ˜¯å¦éœ€è¦ä¸€ä¸ªç©ºçš„body</span></div><div class="line">  <span class="keyword">if</span> (statuses.empty[code]) &#123;</div><div class="line"></div><div class="line">    <span class="comment">// æŠŠbodyæ¸…ç©º</span></div><div class="line">    ctx.body = <span class="literal">null</span>;</div><div class="line"></div><div class="line">    <span class="comment">// è¿”å›</span></div><div class="line">    <span class="keyword">return</span> res.end();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// å¦‚æœhttpçš„æ–¹æ³•æ˜¯ `HEAD`</span></div><div class="line">  <span class="keyword">if</span> (<span class="string">'HEAD'</span> == ctx.method) &#123;</div><div class="line">    <span class="keyword">if</span> (!res.headersSent &amp;&amp; isJSON(body)) &#123;</div><div class="line">      ctx.length = Buffer.byteLength(<span class="built_in">JSON</span>.stringify(body));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// è¿”å›</span></div><div class="line">    <span class="keyword">return</span> res.end();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// bodyä¸ºç©º</span></div><div class="line">  <span class="keyword">if</span> (<span class="literal">null</span> == body) &#123;</div><div class="line"></div><div class="line">    <span class="comment">// æŠŠmessageæˆ–è€…çŠ¶æ€ç æ”¾è¿›å»</span></div><div class="line">    body = ctx.message || <span class="built_in">String</span>(code);</div><div class="line">    <span class="keyword">if</span> (!res.headersSent) &#123;</div><div class="line">      ctx.type = <span class="string">'text'</span>;</div><div class="line">      ctx.length = Buffer.byteLength(body);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// è¿”å›</span></div><div class="line">    <span class="keyword">return</span> res.end(body);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// responses</span></div><div class="line">  <span class="keyword">if</span> (Buffer.isBuffer(body)) <span class="keyword">return</span> res.end(body);</div><div class="line">  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> body) <span class="keyword">return</span> res.end(body);</div><div class="line">  <span class="keyword">if</span> (body <span class="keyword">instanceof</span> Stream) <span class="keyword">return</span> body.pipe(res);</div><div class="line"></div><div class="line">  <span class="comment">// å¦‚æœæ‰€æœ‰çš„åˆ¤æ–­éƒ½é€šè¿‡äº†ï¼Œå°±å½“jsonæ¥å¤„ç†</span></div><div class="line">  body = <span class="built_in">JSON</span>.stringify(body);</div><div class="line">  <span class="keyword">if</span> (!res.headersSent) &#123;</div><div class="line">    ctx.length = Buffer.byteLength(body);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// è¿”å›</span></div><div class="line">  res.end(body);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæ˜¯<a href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback" target="_blank" rel="external"><code>res.end</code>çš„è§£é‡Š</a></p>
<blockquote>
<p>This method signals to the server that all of the response headers and body have been sent</p>
</blockquote>
<p><code>headersSent</code>å’Œ</p>
<h4 id="writable"><a href="#writable" class="headerlink" title="writable"></a>writable</h4><p><code>writable</code>æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„å˜é‡ï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°<a href="https://github.com/koajs/koa/blob/13c7ca61392acecff026a079623ab0d928ea0d93/lib/response.js#L487-L505" target="_blank" rel="external">å®šä¹‰çš„åœ°æ–¹</a>ã€‚</p>
<blockquote>
<p>canâ€™t write any more after response finished</p>
</blockquote>
<p>é˜²æ­¢åœ¨å“åº”ä¹‹åçš„å†å†™å…¥ã€‚</p>
<h3 id="koa-compose"><a href="#koa-compose" class="headerlink" title="koa-compose"></a>koa-compose</h3><p>é¦–å…ˆ<code>compose</code>æŠŠä¸­é—´ä»¶å¤„ç†äº†ä¸€ä¸‹ï¼Œçœ‹çœ‹ä»–æ˜¯å¦‚ä½•å®ç°çš„ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> compose = <span class="built_in">require</span>(<span class="string">'koa-compose'</span>);</div></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ã€‚è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤å¿«é€Ÿçš„æ‰¾åˆ°ä¸€ä¸ªåº“çš„å®ç°ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> npm home koa-compose</div></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿæˆ‘ä»¬æŠŠ<a href="https://github.com/koajs/compose/blob/master/index.js" target="_blank" rel="external">å®šä¹‰çš„æ–‡ä»¶</a>æ‰“å¼€çœ‹çœ‹ã€‚ä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘æŠŠå…¶ä¸­çš„æ³¨é‡Šå’Œéƒ¨åˆ†ç±»å‹åˆ¤æ–­åˆ æ‰äº†ã€‚</p>
<p>ç¡®ä¿ä½ å¯¹<code>Promise</code>å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä¸ç„¶ä½ ä¼šå¯¹æ¥ä¸‹é‡Œçš„è®²è§£å¾ˆå›°æƒ‘ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£ä¸‹é¢çš„è¿è¡ŒåŸç†ï¼Œå…ˆè®©æˆ‘ä»¬å¤ä¹ ä¸€ä¸‹koaçš„ä¸­é—´ä»¶è¿è¡Œé¡ºåºï¼Œåªè¦å¼„æ˜ç™½ä¸‹å›¾æ˜¯æ€ä¹ˆå›äº‹å°±å¯ä»¥äº†ã€‚<br><img src="https://github.com/koajs/koa/blob/master/docs/middleware.gif" alt="middleware.gif"></p>
<p>å¾ˆå¥½ï¼Œé‚£æˆ‘ä»¬å¼€å§‹ã€‚<br>å™¢ï¼Œå¯¹ï¼Œè®°å¾—æŠŠå®ƒæƒ³è±¡æˆæ´‹è‘±ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span> (<span class="params">middleware</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// é¦–å…ˆä¼šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯createContexté‡Œçš„fn</span></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// æ ‡è¯†</span></div><div class="line">    <span class="keyword">let</span> index = <span class="number">-1</span></div><div class="line"></div><div class="line">    <span class="comment">// è°ƒç”¨ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç„¶åå¼€å§‹å¾ªç¯è°ƒç”¨</span></div><div class="line">    <span class="keyword">return</span> dispatch(<span class="number">0</span>)</div><div class="line"></div><div class="line">    <span class="comment">// è°ƒç”¨ä¸­é—´ä»¶</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span> (<span class="params">i</span>) </span>&#123;</div><div class="line"></div><div class="line">      <span class="comment">// ä½ ä¸å¯ä»¥å†ä¸€æ¬¡è¯·æ±‚é‡Œå¤šæ¬¡è°ƒç”¨next</span></div><div class="line">      <span class="keyword">if</span> (i &lt;= index) <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'next() called multiple times'</span>))</div><div class="line"></div><div class="line">      <span class="comment">// è®°å½•è¿™æ˜¯ç¬¬å‡ ä¸ªä¸­é—´ä»¶</span></div><div class="line">      index = i</div><div class="line"></div><div class="line">      <span class="comment">// æŠŠä¸­é—´ä»¶èµ‹å€¼ä¸ºfnï¼Œè¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œä¸­é—´ä»¶çš„è°ƒç”¨é¡ºåºå–å†³äºä¹‹å‰ç”¨useçš„é¡ºåº</span></div><div class="line">      <span class="keyword">let</span> fn = middleware[i]</div><div class="line"></div><div class="line">      <span class="comment">// æœ€åä¸€æ¬¡çš„æ—¶å€™ï¼ŒæŠŠnextå½“æˆfnæ¥å¤„ç†ï¼Œä¸ºäº†é˜²æ­¢æ— é™å¾ªç¯</span></div><div class="line">      <span class="comment">// https://github.com/koajs/compose/commit/2200a75657e1facd29718d84cf1e47677bfb6156</span></div><div class="line">      <span class="keyword">if</span> (i === middleware.length) fn = next</div><div class="line"></div><div class="line">      <span class="comment">// fnæ²¡æœ‰äº†çš„è¯ï¼Œå°±æ˜¯å¤„ç†å®Œæ¯•äº†</span></div><div class="line">      <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve()</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// å¾ªç¯è°ƒç”¨ï¼ŒæŠŠæ ‡å¿—åŠ ä¸€ï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶äº†</span></div><div class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(fn(context, <span class="function"><span class="keyword">function</span> <span class="title">next</span> (<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> dispatch(i + <span class="number">1</span>)</div><div class="line">        &#125;))</div><div class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¨€é‡Œç³Šæ¶‚çš„æ„Ÿè§‰ï¼Ÿé‚£å°±æ¥çœ‹çœ‹<a href="https://github.com/koajs/compose/blob/master/test/test.js" target="_blank" rel="external">composeçš„å•å…ƒæµ‹è¯•</a>ã€‚ä¸€èˆ¬å¯¹å‡½æ•°çš„å®šä¹‰ç†è§£ä¸è¿‡æ¥çš„æ—¶å€™ï¼Œå»ç¿»ä¸€ä¸‹æ³¨é‡Šæ˜¯ä¸ªå¾ˆå¥½çš„ä¸»æ„ï¼Œæµ‹è¯•é‡Œå®šä¹‰äº†å‡½æ•°çš„æ‰€æœ‰è¡Œä¸ºã€‚</p>
<p>ç°åœ¨ä½ å¯ä»¥æ„Ÿè§‰åˆ°ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å°±æ˜¯æŠŠä¸€å †ä¸­é—´ä»¶ç»™å‹ç¼©æˆä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ã€‚ä¹Ÿå°±é¡ºä¾¿å¼„æ¸…äº†ä¸­é—´ä»¶çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹ã€‚</p>
<h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>koaçš„æºç å¾ˆç²¾ç®€ï¼Œå› ä¸ºä»–æŠŠæ‰€æœ‰çš„é¢å¤–åŠŸèƒ½éƒ½äº¤ç»™äº†å…¶ä»–çš„ä¸­é—´ä»¶ï¼Œæ¯”å¦‚æ¨¡æ¿å’Œè·¯ç”±ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ€æœ‰è¶£çš„éƒ¨åˆ†è«è¿‡äºä¸­é—´ä»¶çš„å¤„ç†ã€‚</p>
<p>æ„Ÿè°¢ä½ çš„é˜…è¯» ï¼šD</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/06/axioså‘é€formData/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/06/axioså‘é€formData/" itemprop="url">axioså‘é€formData</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-06T13:13:42+08:00">
                2017-10-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™æ˜¯ä¸€ä¸ªå‘ï¼Œ<br>å› ä¸ºaxiosæ— æ³•åœ¨nodejsçš„ç¯å¢ƒä¸­å‘é€formDataã€‚</p>
<p><a href="https://github.com/axios/axios#request-config" target="_blank" rel="external">https://github.com/axios/axios#request-config</a></p>
<blockquote>
<p><code>data</code> is the data to be sent as the request body<br>Only applicable for request methods â€˜PUTâ€™, â€˜POSTâ€™, and â€˜PATCHâ€™<br>When no <code>transformRequest</code> is set, must be of one of the following types:</p>
<ul>
<li>string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</li>
<li>Browser only: FormData, File, Blob</li>
<li>Node only: Stream, Buffer</li>
</ul>
</blockquote>
<p>æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå«form-dataçš„åº“ï¼Œ<br>ä½†æ²¡æœ‰ä»€ä¹ˆæ•ˆæœï¼Œ<br>äºæ˜¯å°±æ‰‹åŠ¨çš„å†™å…¥äº†ï¼Œ<br>ä¼¼ä¹æ•ˆæœæ›´å¥½ä¸€äº›ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">tweet</span> (<span class="params">content</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">await</span> axios(&#123;</div><div class="line">    method: <span class="string">'post'</span>,</div><div class="line">    url: <span class="string">'https://api.com'</span>,</div><div class="line">    headers: &#123;</div><div class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span></div><div class="line">    &#125;,</div><div class="line">    data: <span class="string">`content=<span class="subst">$&#123;content&#125;</span>`</span></div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/05/catch-async-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/05/catch-async-function/" itemprop="url">catch async function</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-05T18:37:21+08:00">
                2017-10-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>äº‹å®ä¸Šï¼ŒPromiseå’Œasyncçš„é”™è¯¯æ•æ‰æ˜¯å¯ä»¥ç›¸äº’è½¬åŒ–çš„ã€‚<br>ä½†çœ‹èµ·æ¥è›®å¥‡æ€ªçš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'ğŸ'</span>))</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">await</span> run()</div><div class="line">&#125;</div><div class="line"></div><div class="line">main().catch(<span class="built_in">console</span>.log)</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/04/åä¸€æ”¾å‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/04/åä¸€æ”¾å‡/" itemprop="url">åä¸€æ”¾å‡</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-04T10:48:11+08:00">
                2017-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è€å®¶ç”šæ˜¯æ— èŠï¼Œ<br>è€å¤ªå¤ªç”µç“¶è½¦èµ°è·¯ä¸­å¤®ï¼Œ<br>åšå†³ä¸è®©é“ï¼Œ<br>ç”šæ˜¯ç¥æ°”ã€‚</p>
<p>ingressæ–°æ´»åŠ¨ç‰Œå­ç”šæ˜¯ä¸‘ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹æºç å¥½äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/04/Rx.js/Rxjs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/04/Rx.js/Rxjs/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-04T10:17:03+08:00">
                2017-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>å†…å®¹æ•´ç†è‡ª<br><a href="https://www.youtube.com/watch?v=ei7FsoXKPl0" target="_blank" rel="external">https://www.youtube.com/watch?v=ei7FsoXKPl0</a><br><a href="http://reactivex.io/rxjs/manual/overview.html" target="_blank" rel="external">http://reactivex.io/rxjs/manual/overview.html</a></p>
</blockquote>
<h2 id="Rxjs"><a href="#Rxjs" class="headerlink" title="Rxjs"></a>Rxjs</h2><p>RxJS is a library for composing asynchronous and event-based programs by using observable sequences. It provides one core type, the Observable, satellite types (Observer, Schedulers, Subjects) and operators inspired by Array#extras (map, filter, reduce, every, etc) to allow handling asynchronous events as collections.</p>
<blockquote>
<p>Think of RxJS as Lodash for events.</p>
</blockquote>
<p>å“åº”å¼ç¼–ç¨‹ã€‚</p>
<p>è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
<p>è¿­ä»£å™¨æ¨¡å¼ã€‚</p>
<h2 id="è°ƒè¯•æ¨¡æ¿"><a href="#è°ƒè¯•æ¨¡æ¿" class="headerlink" title="è°ƒè¯•æ¨¡æ¿"></a>è°ƒè¯•æ¨¡æ¿</h2><p><a href="https://jsfiddle.net/yztmb0dz/" target="_blank" rel="external">https://jsfiddle.net/yztmb0dz/</a></p>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>å¼€å¤´æ˜¯ä¸€ä¸ªç‚¹ï¼Œ<br>ç»“æŸæ—¶ä¸€ä¸ªç‚¹ï¼Œ<br>æ•°æ®åœ¨ä¸¤ä¸ªç‚¹ä¹‹é—´æµåŠ¨ã€‚</p>
<p>åœ¨ç”Ÿäº§çº¿çš„å¼€å¤´æŠ•å…¥åŸæ–™ï¼Œ<br>ä¸­é—´ç»è¿‡å„ç§åŠ å·¥å¤„ç†ï¼Œ<br>æœ€ç»ˆåœ¨å‡ºå£å¾—åˆ°æˆå“ã€‚</p>
<h3 id="æµï¼ˆStreamï¼‰"><a href="#æµï¼ˆStreamï¼‰" class="headerlink" title="æµï¼ˆStreamï¼‰"></a>æµï¼ˆStreamï¼‰</h3><h3 id="æ“ä½œå™¨ï¼ˆOperatorï¼‰"><a href="#æ“ä½œå™¨ï¼ˆOperatorï¼‰" class="headerlink" title="æ“ä½œå™¨ï¼ˆOperatorï¼‰"></a>æ“ä½œå™¨ï¼ˆOperatorï¼‰</h3><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>åšå±æ€§è¿‡æ»¤</p>
<h4 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h4><p>reduce</p>
<h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://limichange.uedtoutiao.com/2017/10/04/Project/SPAéƒ¨ç½²æµç¨‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Limichange">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Limichange Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/04/Project/SPAéƒ¨ç½²æµç¨‹/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-04T10:17:03+08:00">
                2017-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##</p>
<p>ç”±äºSPAçš„åˆ†ç¦»æ€§å¯¼è‡´Featureæ— æ³•å‰ååŒæ—¶ä¸Šçº¿ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ã€‚<br>å°±æ˜¯å½“ä¸€æ–¹ä¸Šçº¿åï¼Œå¦ä¸€æ–¹è¿˜æ²¡æœ‰å‡†å¤‡å¥½ã€‚</p>
<h2 id="æ¥å£ä¸Šçº¿"><a href="#æ¥å£ä¸Šçº¿" class="headerlink" title="æ¥å£ä¸Šçº¿"></a>æ¥å£ä¸Šçº¿</h2><h2 id="å¯ç”¨Feature-Config"><a href="#å¯ç”¨Feature-Config" class="headerlink" title="å¯ç”¨Feature Config"></a>å¯ç”¨Feature Config</h2><h2 id="å¦‚æœä¸åœ¨ä¹"><a href="#å¦‚æœä¸åœ¨ä¹" class="headerlink" title="å¦‚æœä¸åœ¨ä¹"></a>å¦‚æœä¸åœ¨ä¹</h2><p>é‚£å°±å½“æˆ‘æ²¡è¯´</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Limichange</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Limichange</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    

    

  




	





  










  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.3"></script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
